# This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Auto Deployment

on:
  push:
    branches: [ backend/develop ]
  pull_request:
    branches: [ backend/develop ]

jobs:
  deployment:
    runs-on: ubuntu-latest

    steps:
      - name: HTTP Request
        id: rebuild
        uses: fjogeleit/http-request-action@v1.8.0
        with:
          url: 'http://api.cervidae.com.au:8000/rest/rebuild'
          method: 'GET'
          timeout: 60000

      - name: Wait / Sleep
        uses: jakejarvis/wait-action@v0.1.0
        with:
          time: '10s'

      - name: HTTP Request
        id: check
        uses: fjogeleit/http-request-action@v1.8.0
        with:
          url: 'http://api.cervidae.com.au:8000/rest/check'
          method: 'GET'

      - name: Check Service Status
        run: if [ ${{ steps.check.outputs.response }} -eq 1 ]; then echo "service nominal"; else exit 1; fi

      - name: HTTP Request
        id: info
        uses: fjogeleit/http-request-action@v1.8.0
        with:
          url: 'http://api.cervidae.com.au:8000/rest/info'
          method: 'GET'

      - name: Show Response
        run: echo ${{ steps.info.outputs.response }}
